/**
 * Module dependencies.
 */
var common = require('./index.js'),
    affordance = common.affordance,
    affordances = common.affordances,
    decoder = common.decoder,
    encoder = common.encoder,
    input = common.input,
    naval = common.naval;

/**
 * Create an instance of Encoder and Decoder.
 */
var encoderInstance = encoder(naval),
    decoderInstance = decoder(naval);

/*
 api 'api.example.com'
 protocol 'HTTP'
 meta 'Host': 'api.example.com'
 req 'entry', 'GET', '/'
 req 'get-users', 'GET', '/users'
 req 'get-user', 'GET', '/users/:user'
 req 'del-user', 'DELETE', '/users/:user'
 req 'put-user', 'PUT', '/users/:user'
 meta 'Content-Type': 'application/vnd.example.user+json'
 input 'firstname', '', ['text/plain'], true
 res 'put-user', 201, [
 'entry'
 'get-users'
 'get-user'
 'del-user'
 'put-user'
 ]
 media 'NavAL'
 */

/**
 * Create some hypermedia, and attempt to serialize it.
 */
var affordancesInstance =
        affordances('api.example.com')
            .setMetadata
            (
                {
                    'Host':'api.example.com',
                    'Accept':'multipart/nav-data'
                }
            )
            .addAffordance
            (
                affordance('entry', 'GET', '/')
            )
            .addAffordance
            (
                affordance('get-users', 'GET', '/users')
            )
            .addAffordance
            (
                affordance('del-user', 'DELETE', '/users/:user')
            )
            .addAffordance
            (
                affordance('put-user', 'PUT', '/users/:user')
                    .setMetadata
                    (
                        {
                            'Content-Type':'application/vnd.example.user+json'
                        }
                    )
                    .addInput(input('first_name', '', ['text/plain'], true))
                    .addInput(input('last_name', '', ['text/plain'], true))
            )
            .addAffordance
            (
                affordances()
                    .addAffordance
                    (
                        affordances('api-collection')
                            .addAffordance
                            (
                                affordances('merchants-api')
                                    .addAffordance
                                    (
                                        affordance('get-merchants', 'GET', '/merchants')
                                    )
                                    .addAffordance
                                    (
                                        affordance('get-merchant', 'GET', '/merchants/:merchant')
                                    )
                            )
                            .addAffordance
                            (
                                affordances('widgets-api')
                                    .addAffordance
                                    (
                                        affordance('get-widgets', 'GET', '/widgets')
                                    )
                                    .addAffordance
                                    (
                                        affordance('get-widget', 'GET', '/widgets/:widget')
                                    )
                            )
                            .addAffordance
                            (
                                affordances('other-widgets-api')
                                    .addAffordance
                                    (
                                        /**
                                         * Identifier collision with previous get-widgets.
                                         */
                                        affordance('get-widgets', 'GET', '/otherwidgets')
                                    )
                            )
                    )
            )
            .addAffordance
            (
                affordances('')
            ),
    affordanceInstance =
        affordance('entry', 'GET', '/');

console.log('TEST 1');
console.dir(encoderInstance.encode(null));
console.log('TEST 2');
console.dir(encoderInstance.encode(affordancesInstance));
console.log('TEST 3');
console.dir(encoderInstance.encode(affordanceInstance));
console.log('TEST 4');
console.dir(decoderInstance.decode(null));
console.log('TEST 5');
console.dir(decoderInstance.decode(''));
console.log('TEST 6');
console.dir(decoderInstance.decode('1'));
console.log('TEST 7');
console.log(JSON.stringify(decoderInstance.decode(encoderInstance.encode(affordancesInstance)), null, 2));
console.log('TEST 8');
console.log(JSON.stringify(decoderInstance.decode(encoderInstance.encode(affordanceInstance)), null, 2));
console.log('TEST 9');
console.dir(affordances.isPrototypeOf(decoderInstance.decode(encoderInstance.encode(affordancesInstance))));
console.log('TEST 10');
console.dir(affordance.isPrototypeOf(decoderInstance.decode(encoderInstance.encode(affordanceInstance))));
console.log('TEST 11');
console.dir(affordance.isPrototypeOf(decoderInstance.decode(encoderInstance.encode(affordancesInstance))));
console.log('TEST 12');
console.dir(affordances.isPrototypeOf(decoderInstance.decode(encoderInstance.encode(affordanceInstance))));
console.log('TEST 13');
console.dir(affordancesInstance.getAffordanceById());
console.log('TEST 14');
console.dir(affordancesInstance.getAffordanceById(''));
console.log('TEST 15');
console.dir(affordancesInstance.getAffordanceById('entry'));
console.log('TEST 16');
console.dir(affordancesInstance.getAffordanceById('get-users'));
console.log('TEST 17');
console.dir(affordancesInstance.getAffordanceById('del-user'));
console.log('TEST 18');
console.dir(affordancesInstance.getAffordanceById('put-user'));
console.log('TEST 18');
console.dir(affordancesInstance.getAffordanceById('api-collection'));
console.log('TEST 19');
console.dir(affordancesInstance.getAffordanceById('merchants-api'));
console.log('TEST 20');
console.dir(affordancesInstance.getAffordanceById('get-merchants'));
console.log('TEST 21');
console.dir(affordancesInstance.getAffordanceById('get-merchant'));
console.log('TEST 22');
console.dir(affordancesInstance.getAffordanceById('widgets-api'));
console.log('TEST 23');
console.dir(affordancesInstance.getAffordanceById('get-widgets'));
console.log('TEST 24');
console.dir(affordancesInstance.getAffordanceById('get-widget'));
console.log('TEST 25');
console.dir(affordancesInstance.getAffordanceById('get-widge'));
console.log('END TESTS');
