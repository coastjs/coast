/**
 * Falsy Values: false, 0, "", null, undefined, NaN
 */

/**
 * Augments the Function type object's prototype with a method called "method."
 * This method allows any Constructor Function, that prototypally inherits from
 * Function.prototype (so all Constructor Functions), to easily add methods to
 * their own prototype objects.
 *
 * @param name is the name of the method passed as a String object argument.
 * @param func is the first-class function object passed in as an argument.
 * @return {*} a reference to your respective Constructor Function.
 */
Function.prototype.method = function (name, func) {
    this.prototype[name] = func;
    return this;
};

/**
 * Module Dependencies.
 */
var plugin = require('./plugin.js'),
    hapi = require('xhn').hapi;

/**
 * A Hypermediator allows a user to spawn a live HTTP server using various Node HTTP server frameworks with the support
 * of Plugin extensions. It utilizes XHN's HypermediaApi instances to specify how a Hypermedia API is modeled, and
 * creates an HTTP server programmatically from the HAPI DSL.
 *
 * @param extension should be an instance of {Plugin}. This argument is optional, and the field will be initialized
 * to null.
 * @return {*}
 * @constructor
 */
function Hypermediator(extension) {
    this._plugin = (plugin.isPrototypeOf(extension)) ? extension : null;
    return this;
}

/**
 * Accessor method to allow the setting of the Plugin extension.
 *
 * @param extension should be an instance of {Plugin}.
 * @return {*} for chaining.
 */
Hypermediator.method('setPlugin', function (extension) {
    this._plugin = (plugin.isPrototypeOf(extension)) ? extension : this._plugin;
    return this;
});

/**
 * Mediates an instance of {HypermediaApi} using a Plugin extension. This should result in the spawning of an HTTP
 * server from the instance of {HypermediaApi} provided in the function argument.
 *
 * @param api should be an instance of {HypermediaApi}.
 * @return true if an HTTP server was spawned; false, otherwise.
 */
Hypermediator.method('mediate', function (api) {
    /**
     * Get a stack frame reference to the {Plugin} field.
     * The reference may be a {Plugin} or null.
     */
    var extension = this._plugin;
    /**
     * If the api argument of this method passed an instance of HypermediaApi, and the field was a Plugin extension
     * capable of bridging the HypermediaApi to a live server instance, then attempt to carry out the bridging.
     *
     * This should return true if the HTTP server was started, and false otherwise.
     */
    if (hapi.isPrototypeOf(api) && plugin.isPrototypeOf(extension)) {
        return extension.bridge(api);
    }
    /**
     * If it was not capable of bridging to a live HTTP server instance, then return false to indicate this.
     */
    return false;
});

/**
 * Convenience method to enforce safe method invocations without the use of the new operator.
 *
 * @param extension should be an instance of {Plugin}. This argument is optional, and the field will be initialized
 * to null.
 * @return {Hypermediator}
 */
function hypermediator(extension) {
    return new Hypermediator(extension);
}

/**
 * Convenience method to allow for type checking outside of the scope of this module.
 *
 * @param object is a reference to an object you would like to test the prototypal inheritance chain on.
 * @return {Boolean}
 */
hypermediator.isPrototypeOf = function (object) {
    return object instanceof Hypermediator;
};

module.exports = exports = hypermediator;
